---
abbrlink: 2
---


> [【设计模式】C++设计模式（全26讲）](<https://www.bilibili.com/video/av52251106/?p=2>)

## 设计模式简介

目标：

- 理解松耦合设计思想
- 掌握面向对象设计原则
- 掌握重构技法改善设计
- 掌握GOF 核心设计模式

### 什么是设计模式

> “每一个模式描述了一个在我们周围不断重复发生的问题，以及该问题的解决方案的核心。这样，你就能一次又一次地使用该方案而不必做重复劳动”。
>
> ​																													——Christopher Alexander

### 从面向对象谈起

**底层思维**：向下，如何把握机器底层从微观理解对象构造

- 语言构造

- 编译转换

- 内存模型 

- 运行时机制

**抽象思维**：向上，如何将我们的周围世界抽象为程序代码 

- 面向对象 

- 组件封装 

- 设计模式 

- 架构模式

### 深入理解面向对象

**向下**：深入理解三大面向对象机制 

- 封装，隐藏内部实现 

- 继承，复用现有代码 

- 多态，改写对象行为

**向上**：深刻把握面向对象机制所带来的抽象意义，理解如何使用这些机制来表达现实世界，掌握什么是“好的面向对象设计”

### 软件设计固有的复杂性

> 建筑商从来不会去想给一栋已建好的100层高的楼房底下再新修一个小地下室——这样做花费极大而且注定要失败。然而令人惊奇的是，软件系统的用户在要求作出类似改变时却不会仔细考虑，而且他们认为这只是需要简单编程的事。 
>
> ​																	——Object-Oriented Analysis and Design with Applications

### 软件设计复杂的根本原因

**变化**

- 客户需求的变化
- 技术平台的变化
- 开发团队的变化
- 市场环境的变化
- ......

### 如何解决复杂性？

**分解** 

- 人们面对复杂性有一个常见的做法：即分而治之，将大问题分 解为多个小问题，将复杂问题分解为多个简单问题。 

**抽象** 

- 更高层次来讲，人们处理复杂性有一个通用的技术，即抽象。 由于不能掌握全部的复杂对象，我们选择忽视它的非本质细节， 而去处理泛化和理想化了的对象模型。

**结构化 VS. 面向对象**

### 软件设计的目标

什么是好的软件设计？软件设计的金科玉律：**复用！**

## 面向对象设计原则

### 面向对象设计，为什么？

变化是复用的天敌！面向对象设计最大的优势在于：**抵御变化！**

### 重新认识面向对象

**理解隔离变化** 

- 从宏观层面来看，面向对象的构建方式更能适应软件的变化， 能将变化所带来的影响减为最小 

**各司其职** 

- 从微观层面来看，面向对象的方式更强调各个类的“责任” 

- 由于需求变化导致的新增类型不应该影响原来类型的实现——是所谓各负其责 

**对象是什么？** 

- 从语言实现层面来看，对象封装了代码和数据。 

- 从规格层面讲，对象是一系列可被使用的公共接口。 

- 从概念层面讲，对象是某种拥有责任的抽象。

### 面向对象设计原则

**依赖倒置原则（DIP）** 

- 高层模块(稳定)不应该依赖于低层模块(变化)，二者都应该依赖于抽象(稳定) 。 

- 抽象(稳定)不应该依赖于实现细节(变化) ，实现细节应该依赖于抽象(稳定)。 

**开放封闭原则（OCP）** 

- 对扩展开放，对更改封闭。 

- 类模块应该是可扩展的，但是不可修改。

**单一职责原则（SRP）** 

- 一个类应该仅有一个引起它变化的原因。 

- 变化的方向隐含着类的责任。

**Liskov 替换原则（LSP）** 

- 子类必须能够替换它们的基类(IS-A)。 

- 继承表达类型抽象。

**接口隔离原则（ISP）** 

- 不应该强迫客户程序依赖它们不用的方法。 

- 接口应该小而完备。

**优先使用对象组合，而不是类继承** 

- 类继承通常为“白箱复用”，对象组合通常为“黑箱复用”。 

- 继承在某种程度上破坏了封装性，子类父类耦合度高。 

- 而对象组合则只要求被组合的对象具有良好定义的接口，耦合 度低。

**封装变化点** 

- 使用封装来创建对象之间的分界层，让设计者可以在分界层的 一侧进行修改，而不会对另一侧产生不良的影响，从而实现层 次间的松耦合。

**针对接口编程，而不是针对实现编程** 

- 不将变量类型声明为某个特定的具体类，而是声明为某个接口。 

- 客户程序无需获知对象的具体类型，只需要知道对象所具有的 接口。 

- 减少系统中各部分的依赖关系，从而实现“高内聚、松耦合” 的类型设计方案。

### 面向接口设计

产业强盛的标志：**接口标准化!**

### 将设计原则提升为设计经验

1. **设计习语 Design Idioms** 
   - Design Idioms 描述与特定编程语言相关的低层模式，技巧， 惯用法。 

2. **设计模式 Design Patterns** 
   - Design Patterns主要描述的是“类与相互通信的对象之间的组 织关系，包括它们的角色、职责、协作方式等方面。 

3. **架构模式 Architectural Patterns** 
   - Architectural Patterns描述系统中与基本结构组织关系密切的 高层模式，包括子系统划分，职责，以及如何组织它们之间关系的规则。

## Template Method

### GOF-23 模式分类

**从目的来看**： 

- 创建型（Creational）模式：将对象的部分创建工作延迟到子 类或者其他对象，从而应对需求变化为对象创建时具体类型实 现引来的冲击。 

- 结构型（Structural）模式：通过类继承或者对象组合获得更灵 活的结构，从而应对需求变化为对象的结构带来的冲击。 

- 行为型（Behavioral）模式：通过类继承或者对象组合来划分 类与对象间的职责，从而应对需求变化为多个交互的对象带来 的冲击。 

**从范围来看**： 

- 类模式处理类与子类的静态关系。 

- 对象模式处理对象间的动态关系。 

### 从封装变化角度对模式分类

**组件协作**：

- Template Method 

- Observer / Event

- Strategy

**单一职责：**

- Decorator

- Bridge

**对象创建:**

- Factory Method

- Abstract Factory

- Prototype

- Builder

**对象性能：**

- Singleton

- Flyweight

**接口隔离:**

- Façade

- Proxy

- Mediator

- Adapter

**状态变化：**

- Memento

- State

**数据结构：**

- Composite

- Iterator

- Chain of Resposibility

**行为变化：**

- Command

- Visitor

**领域问题：**

- Interpreter 

### 重构获得模式 Refactoring to Patterns

- 面向对象设计模式是“好的面向对象设计”，所谓“好的面向对 象设计”指是那些可以满足 “应对变化，提高复用”的设计 。 

- 现代软件设计的特征是“需求的频繁变化”。设计模式的要点是 “寻找变化点，然后在变化点处应用设计模式，从而来更好地应对 需求的变化”.“什么时候、什么地点应用设计模式”比“理解设计模式结构本身”更为重要。 

- 设计模式的应用不宜先入为主，一上来就使用设计模式是对设计 模式的最大误用。没有一步到位的设计模式。敏捷软件开发实践提倡的“Refactoring to Patterns”是目前普遍公认的最好的使用设计模式的方法。

### 重构关键技法

- 静态 --> 动态 

- 早绑定 --> 晚绑定 

- 继承 --> 组合 

- 编译时依赖 --> 运行时依赖 

- 紧耦合 --> 松耦合

### “组件协作”模式:

- 现代软件专业分工之后的第一个结果是“框架与应用程序的划分”，“组件协作”模式通过晚期绑定，来实现框架与应用程序之 间的松耦合，是二者之间协作时常用的模式。 

- 典型模式 
  - Template Method 
  - Observer / Event 
  - Strategy

## Template Method 模式

### **动机（Motivation）** 

- 在软件构建过程中，对于某一项任务，它常常有稳定的整体操作结构，但各个子步骤却有很多改变的需求，或者由于固有的原因 （比如框架与应用之间的关系）而无法和任务的整体结构同时实现。 

- 如何在确定稳定操作结构的前提下，来灵活应对各个子步骤的变化或者晚期实现需求？

### **模式定义** 

> 定义一个操作中的算法的骨架 (稳定)，而将一些步骤延迟
>
> (变化)到子类中。Template Method使得子类可以不改变 
>
> (复用)一个算法的结构即可重定义(override 重写)该算法的某些特定步骤。 
>
> ​																														——《设计模式》GoF

### **要点总结** 

- Template Method模式是一种非常基础性的设计模式，在面向对象系统中有着大量的应用。它用最简洁的机制（虚函数的多态性）为很多应用程序框架提供了灵活的扩展点，是代码复用方面的基本 实现结构。 

- 除了可以灵活应对子步骤的变化外，“不要调用我，让我来调用你”的反向控制结构是Template Method的典型应用。 

- 在具体实现方面，被Template Method调用的虚方法可以具有实现，也可以没有任何实现（抽象方法、纯虚方法），但一般推荐将它们设置为protected方法。













